<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <!-- <meta http-equiv='X-UA-Compatible' content='IE=edge'> -->
    <title>ImageWithText</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'> -->
    <!-- <script src='main.js'></script> -->
    <script>
        let images;
        let image;
        let fileInput;
        let canv;
        let ctx;
        let scale = 1;
        function init(){
            fileInput = document.getElementById("file-input");
            canv = document.getElementById("canvas");
            ctx = canv.getContext("2d");
            // ファイル選択イベントに対するリスナを追加
            fileInput.addEventListener("change", (event) => {
                // 画像のインスタンスを取得
                const file = event.target.files[0];
                // リーダーで読み込む
                const reader = new FileReader();
                reader.readAsDataURL(file);
                // 読み込んだときに自動で処理されるようにする
                reader.onload = () => {
                    const imageData = reader.result;
                    image = new Image();
                    image.src = imageData;
                    image.onload = () => {
                        ctx.drawImage(image, 0, 0);
                        // 第4,5引数で渡したpxに対応するように、拡大縮小される。
                        // ctx.drawImage(image, 0, 0, image.width*2,image.height*2);
                    };
                    // ctx.clearRect(0,0,canv.width,canv.height);
                };
            });
        }
        function enlarge(){
            scale += 0.1;
            ctx.clearRect(0,0,canv.width,canv.height);
            ctx.drawImage(image, 0, 0, image.width*scale, image.height*scale);
        }
        function shrink(){
            scale -= 0.1;
            ctx.clearRect(0,0,canv.width,canv.height);
            ctx.drawImage(image, 0, 0, image.width*scale, image.height*scale);
        }
        function saveAsImage(){
            const dataURL = canv.toDataURL();
            // 画像の保存
            const a = document.createElement("a");
            a.href = dataURL;
            a.download = "IWTSample.jpg";
            a.click();
        }
    </script>
</head>
<body onload="init()">
    <h1><span id="h1.title">ImageWithText</span></h1>
    <span id="discription">画像を複数枚読み込んで、短い文章と結合して一枚の画像にします。画像を使って何かを表現したいときにどうぞ。</span><br>
    <!-- とりあえず一つの画像の処理を試みる -->
    <input type="file" id="file-input"><br>
    <!-- <input type="file" id="file-input" accept=".jpg, .png, .jpeg"><br> -->
    <!-- <input type="file" id="file-input" multiple accept=".jpg, .png, .jpeg"><br> -->
    <span>↓キャンバス↓</span><br>
    <canvas id="canvas" width="500" height="500"></canvas><br>
    <button onclick="enlarge()" style="margin-right: 10px">拡大</button>
    <button onclick="shrink()">縮小</button><br>
    <button onclick="saveAsImage()" style="margin-top: 5px">保存</button>
</body>
</html>